<!DOCTYPE html>
<html>
<head>
    <title>Admin's Dashboard - DCICD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<a href="/logout" class="btn btn-danger position-absolute top-0 end-0 m-4">Logout</a>
<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="bg-white p-4 rounded shadow" style="max-width: 400px; width:100%;">
        <h2 class="text-center mb-4">
            Welcome to Admin Dashboard
            <span class="text-primary" id="user-display">{{ username }}</span>
        </h2>
        <div class="d-grid gap-3">
            <a href="/ipfs-repo-operation" class="btn btn-primary">IPFS Repo Operation</a>
            <a href="/ci-cd-operations" class="btn btn-primary">CI CD Operation</a>
            <a href="/user-management" class="btn btn-primary">User Management</a>
            <a href="/get_logs" class="btn btn-primary">Deployment Logs</a>
            <input type="password" class="form-control" placeholder="Password" id="pass-field">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="check-box">
                <label class="form-check-label" for="check-box">
                    I confirm to sync nodes
                </label>
            </div>
            <button id="sync-button" class="btn btn-warning" disabled>Sync IPFS Nodes</button>
        </div>
    </div>
</div>
<script>
function checkForm() {
    var password = document.getElementById("pass-field").value.trim();
    var checked = document.getElementById("check-box").checked;
    var button = document.getElementById("sync-button");
    button.disabled = !(password && checked);
}

document.getElementById("pass-field").addEventListener("input", checkForm);
document.getElementById("check-box").addEventListener("change", checkForm);

document.getElementById("sync-button").addEventListener("click", function() {
    var button = this;
    var userPassword = document.getElementById("pass-field").value.trim();
    var userConfirm = document.getElementById("check-box").checked;
    
    if (!userPassword || !userConfirm) return;
    
    button.classList.remove("btn-success", "btn-danger");
    button.classList.add("btn-warning");
    
    fetch("/sync_nodes", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "password=" + encodeURIComponent(userPassword)
    })
    .then(function(response) {
        return response.json();
    })
    .then(function(result) {
        if (result.status) {
            button.classList.remove("btn-warning", "btn-danger");
            button.classList.add("btn-success");
        } else {
            button.classList.remove("btn-warning", "btn-success");
            button.classList.add("btn-danger");
        }
        alert(result.Message);
    })
    .catch(function() {
        button.classList.remove("btn-warning", "btn-success");
        button.classList.add("btn-danger");
        alert("Failed to sync nodes.");
    });
});
</script>
</body>
</html>