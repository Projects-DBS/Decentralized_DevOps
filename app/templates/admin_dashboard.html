<!DOCTYPE html>
<html>
<head>
    <title>Admin's Dashboard - DCICD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<a href="/logout" class="btn btn-danger position-absolute top-0 end-0 m-4">Logout</a>

<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="bg-white p-4 rounded shadow" style="max-width: 400px; width:100%;">
        <h2 class="text-center mb-4">
            Welcome to Admin Dashboard
            <span class="text-primary" id="username-display">{{ username }}</span>
        </h2>
        <div class="d-grid gap-3">
            <a href="/ipfs-repo-operation" class="btn btn-primary">IPFS Repo Operation</a>
            <a href="/ci-cd-operations" class="btn btn-primary">CI CD Operation</a>
            <a href="/user-management" class="btn btn-primary">User Management</a>
            <a href="/get_logs" class="btn btn-primary">Deployment Logs</a>
            <input type="password" class="form-control" placeholder="Password" id="sync-nodes-password">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="sync-nodes-confirm">
                <label class="form-check-label" for="sync-nodes-confirm">
                    I confirm to sync nodes
                </label>
            </div>
            <button id="sync-nodes-btn" class="btn btn-warning" disabled>Sync IPFS Nodes</button>
        </div>
    </div>
</div>

<script>
function validateSyncForm() {
    var pwd = document.getElementById("sync-nodes-password").value.trim();
    var chk = document.getElementById("sync-nodes-confirm").checked;
    var btn = document.getElementById("sync-nodes-btn");
    btn.disabled = !(pwd && chk);
}
document.getElementById("sync-nodes-password").oninput = validateSyncForm;
document.getElementById("sync-nodes-confirm").onchange = validateSyncForm;

document.getElementById("sync-nodes-btn").onclick = function() {
    var btn = this;
    var password = document.getElementById("sync-nodes-password").value.trim();
    var confirm = document.getElementById("sync-nodes-confirm").checked;
    if (!password || !confirm) return;
    btn.classList.remove("btn-success", "btn-danger");
    btn.classList.add("btn-warning");
    fetch("/sync_nodes", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "password=" + encodeURIComponent(password)
    })
    .then(response => response.json())
    .then(data => {
        if (data.status) {
            btn.classList.remove("btn-warning", "btn-danger");
            btn.classList.add("btn-success");
        } else {
            btn.classList.remove("btn-warning", "btn-success");
            btn.classList.add("btn-danger");
        }
        alert(data.Message);
    })
    .catch(() => {
        btn.classList.remove("btn-warning", "btn-success");
        btn.classList.add("btn-danger");
        alert("Failed to sync nodes.");
    });
};
</script>

</body>
</html>
