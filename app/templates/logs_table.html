<!DOCTYPE html>
<html>
<head>
    <title>Server Logs Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-5">
    <h2 class="mb-4">Server Logs Viewer</h2>
    <label for="serverDropdown" class="form-label fw-bold">Select a Server IP:</label>
    <select id="serverDropdown" class="form-select mb-3"></select>
    <div class="table-responsive">
        <table class="table table-bordered align-middle" id="dataTable">
            <thead class="table-primary">
                <tr>
                    <th>Username</th>
                    <th>Session Started</th>
                    <th>Server IP</th>
                    <th>Role</th>
                    <th>Operation</th>
                    <th>Page</th>
                    <th>Message</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<script>
    var logData = JSON.parse('{{ logs | tojson | safe }}');
    var dropdown = document.getElementById("serverDropdown");
    var tableBody = document.getElementById("dataTable").querySelector("tbody");
    
    function displayRecords(serverIP) {
        tableBody.innerHTML = "";
        if (!logData[serverIP] || logData[serverIP].length === 0) {
            tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No logs available.</td></tr>';
            return;
        }
        
        for (var i = 0; i < logData[serverIP].length; i++) {
            var record = logData[serverIP][i];
            var newRow = document.createElement("tr");
            newRow.innerHTML = '<td>' + (record.username || '') + '</td>' +
                              '<td>' + (record.session_started || '') + '</td>' +
                              '<td>' + (record.server_ip || '') + '</td>' +
                              '<td>' + (record.role || '') + '</td>' +
                              '<td>' + (record.operation || '') + '</td>' +
                              '<td>' + (record.page || '') + '</td>' +
                              '<td>' + (record.message || '') + '</td>' +
                              '<td>' + (record.timestamp || '') + '</td>';
            tableBody.appendChild(newRow);
        }
    }
    
    var serverList = [];
    for (var key in logData) {
        serverList.push(key);
    }
    
    for (var j = 0; j < serverList.length; j++) {
        var option = document.createElement("option");
        option.value = serverList[j];
        option.textContent = serverList[j];
        dropdown.appendChild(option);
    }
    
    if (serverList.length > 0) {
        dropdown.value = serverList[0];
        displayRecords(serverList[0]);
    } else {
        tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No logs available.</td></tr>';
    }
    
    dropdown.addEventListener("change", function () {
        displayRecords(this.value);
    });
</script>
</body>
</html>