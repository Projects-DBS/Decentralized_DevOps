<!DOCTYPE html>
<html>
<head>
    <title>Server Logs Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-5">
    <h2 class="mb-4">Server Logs Viewer</h2>
    <label for="ipSelect" class="form-label fw-bold">Select a Server IP:</label>
    <select id="ipSelect" class="form-select mb-3"></select>
    <div class="table-responsive">
        <table class="table table-bordered align-middle" id="logsTable">
            <thead class="table-primary">
                <tr>
                    <th>Username</th>
                    <th>Session Started</th>
                    <th>Server IP</th>
                    <th>Role</th>
                    <th>Operation</th>
                    <th>Page</th>
                    <th>Message</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<script>
    const logs = JSON.parse('{{ logs | tojson | safe }}');
    const ipSelect = document.getElementById("ipSelect");
    const logsTableBody = document.getElementById("logsTable").querySelector("tbody");

    function renderTable(ip) {
        logsTableBody.innerHTML = "";
        if (!logs[ip] || logs[ip].length === 0) {
            logsTableBody.innerHTML = '<tr><td colspan="8" class="text-center">No logs available.</td></tr>';
            return;
        }
        logs[ip].forEach(entry => {
            let row = document.createElement("tr");
            row.innerHTML = `
                <td>${entry.username ?? ''}</td>
                <td>${entry.session_started ?? ''}</td>
                <td>${entry.server_ip ?? ''}</td>
                <td>${entry.role ?? ''}</td>
                <td>${entry.operation ?? ''}</td>
                <td>${entry.page ?? ''}</td>
                <td>${entry.message ?? ''}</td>
                <td>${entry.timestamp ?? ''}</td>
            `;
            logsTableBody.appendChild(row);
        });
    }

    const allIPs = Object.keys(logs);
    allIPs.forEach(ip => {
        let opt = document.createElement("option");
        opt.value = ip;
        opt.textContent = ip;
        ipSelect.appendChild(opt);
    });

    if (allIPs.length > 0) {
        ipSelect.value = allIPs[0];
        renderTable(allIPs[0]);
    } else {
        logsTableBody.innerHTML = '<tr><td colspan="8" class="text-center">No logs available.</td></tr>';
    }

    ipSelect.addEventListener("change", function () {
        renderTable(this.value);
    });
</script>
</body>
</html>
