<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>User Management</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; }
        .container { max-width: 400px; margin: 40px auto; background: #fff; padding: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background: #eee; }
        #message { text-align: center; margin-bottom: 15px; display: none; }
        #message.success { color: green; }
        #message.error { color: red; }
        button { width: 100%; padding: 10px; background: #3477f5; color: #fff; border: none; border-radius: 4px; font-size: 16px; }
        button:disabled { background: #ccc; }
    </style>
</head>
<body>
<div class="container">
    <h2>Users</h2>
    <div id="message"></div>
    <table>
        <thead>
            <tr>
                <th>Select</th>
                <th>Username</th>
            </tr>
        </thead>
        <tbody id="users"></tbody>
    </table>
    <button id="deleteBtn" disabled>Delete</button>
</div>
<script>
    function showMessage(msg, success=false) {
        const m = document.getElementById('message');
        m.textContent = msg;
        m.className = success ? 'success' : 'error';
        m.style.display = 'block';
    }

    function loadUsers() {
        fetch('/list_all_users')
            .then(r => r.json())
            .then(users => {
                const tbody = document.getElementById('users');
                tbody.innerHTML = '';
                users.forEach(u => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input type="radio" name="user" value="${u.username}"></td>
                        <td>${u.username}</td>
                    `;
                    tbody.appendChild(tr);
                });
                document.querySelectorAll('input[type="radio"]').forEach(rb => {
                    rb.addEventListener('change', () => {
                        document.getElementById('deleteBtn').disabled = false;
                        document.getElementById('message').style.display = 'none';
                    });
                });
                document.getElementById('deleteBtn').disabled = true;
            });
    }

    document.getElementById('deleteBtn').onclick = function() {
        const selected = document.querySelector('input[name="user"]:checked');
        if (!selected) return;
        fetch('/remove-user', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ username: selected.value })
        })
        .then(r => r.json())
        .then(res => {
            showMessage(res.message, res.success);
            loadUsers();
        })
        .catch(() => showMessage('Failed to delete user'));
    };

    loadUsers();
</script>
</body>
</html>
